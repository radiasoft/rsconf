server {
    listen sirepo.v4.radia.run:80;
    server_name sirepo.v4.radia.run;
    return 301 https://sirepo.v4.radia.run$request_uri;
}

server {
    listen sirepo.v4.radia.run:443 ssl;
    server_name sirepo.v4.radia.run;
    root /usr/share/nginx/html;
    ssl_certificate /etc/nginx/conf.d/sirepo.v4.radia.run.crt;
    ssl_certificate_key /etc/nginx/conf.d/sirepo.v4.radia.run.key;
    client_max_body_size 209715200;

    # Enumerate all the Tornado servers here
    upstream sirepo_api {
        server 127.0.0.1:7777;
        server 127.0.0.1:7778;
        server 127.0.0.1:7779;
        server 127.0.0.1:7780;
        server 127.0.0.1:7781;
        server 127.0.0.1:7782;
        server 127.0.0.1:7783;
        server 127.0.0.1:7784;
        server 127.0.0.1:7785;

    }

    # Only one try on requests. The servers are either busy or not.
    proxy_next_upstream off;

    location / {
        allow all;
        proxy_pass http://sirepo_api;
    }
# TODO(robnagler) dump static files into /srv/sirepo/srv/static
# Create a command that generates static/robots.txt and favicon.ico
#    location ^~ /static/ {
#        root /var/www;
#    }
#    location = /favicon.ico {
#        rewrite (.*) /static/img/favicon.ico;
#    }
#TODO(robnagler) needs to be dynamic based on symtypes
#    location = /robots.txt {
#        rewrite (.*) /static/robots.txt;
#    }
}
